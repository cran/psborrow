<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Analysing data with psborrow</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Analysing data with psborrow</h1>



<p>This vignette provides additional details of the analysis model that
is fitted as well as a demonstration of how to use the package to fit
said models to an existing dataset. For examples of how to fit the
analysis model to the simulated datasets generated by the package
itself, please see the user-guide vignette.</p>
<p>The “Analysis Model” section of this vignette is a modified excerpt
from Lu, Y. et al. (2021).</p>
<div id="analysis-model" class="section level2">
<h2>Analysis Model</h2>
<p>The package uses Markov chain Monte Carlo (MCMC) through JAGS to
obtain the posterior distribution for the hazard ratio between treatment
and control arms. The package relies on the Bayesian commensurate prior
approach (Lewis, et al., 2019). The probability density function for the
survival time of patient <span class="math inline">\(i\)</span>
following a Weibull model is as below:</p>
<p><span class="math display">\[
t_i \sim Weibull( \nu, \lambda_i)
\]</span></p>
<p>for <span class="math inline">\(i = 1, 2, \dots,n\)</span>,
where:</p>
<ul>
<li><span class="math inline">\(\nu\)</span> is the shape parameter</li>
<li><span class="math inline">\(\lambda\)</span> is the rate,</li>
<li><span class="math inline">\(n\)</span> is the total sample size of
the analysis population.</li>
</ul>
<p>The probability density function is:</p>
<p><span class="math display">\[
f(t_i, x_i) = \nu\lambda_i t^{\nu-1} e^{-\lambda_it^\nu}
\]</span></p>
<p>with the rate taking the format:</p>
<p><span class="math display">\[
\lambda_i = exp(\alpha_i + \beta_{trt}  \times I_{trt} + \beta^T \times
X_{i})
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\alpha_i = \alpha_{cc}\)</span> if
patient <span class="math inline">\(i\)</span> is in the concurrent
trial, and <span class="math inline">\(\alpha_i = \alpha_{ec}\)</span>
if patient <span class="math inline">\(i\)</span> is in the external
trial. Because the impact of therapy is captured by <span class="math inline">\(I_{trt}\)</span> below, <span class="math inline">\(\alpha_{cc}\)</span> and <span class="math inline">\(\alpha_{ec}\)</span> effectively correspond to the
log of baseline hazard rate for concurrent control arm and external
control arm, respectively.</li>
<li><span class="math inline">\(\beta_n\)</span> is an n-length vector
of regression coefficients<br />
</li>
<li><span class="math inline">\(X_{ni}\)</span> is an n-length covariate
vector for patient <span class="math inline">\(i\)</span>, including all
additional parameters to adjust for (e.g. propensity score).<br />
</li>
<li><span class="math inline">\(I_{trt}\)</span> is the treatment
indicator (value equals to 0 or 1).</li>
</ul>
<p>A hierarchical model is defined in which the log hazard rate for the
concurrent controls is centered on the external controls, i.e. <span class="math inline">\(\alpha_{cc} | \alpha_{ec} \sim N(\alpha_{ec},
\tau)\)</span>. The hyperprior <span class="math inline">\(\tau\)</span>, also referred to as the
commensurability parameter, determines the extent of borrowing (see
Lewis, et al., 2019).</p>
<p>Four borrowing methods have been implemented:</p>
<ol style="list-style-type: decimal">
<li>Not borrowing any external control information</li>
<li>Fully incorporating external control arm patients to the concurrent
control group</li>
<li>Dynamic borrowing with the commensurability hyperparameter <span class="math inline">\(\tau\)</span> following a Gamma distribution</li>
<li>Dynamic borrowing with the commensurability hyperparameter <span class="math inline">\(\tau\)</span> following a half-Cauchy
distribution</li>
</ol>
<p>For methods (1) and (2), a conventional Bayesian model without
dynamic borrowing is deployed with all relevant parameters assigned a
non-informative prior. For method (1) no external control arm
information is used and as such <span class="math inline">\(\alpha_{cc}
= \alpha \sim N(0, 0.0001)\)</span> For method (2) the external control
arm is treated as part of the concurrent control and as such <span class="math inline">\(\alpha_{cc} = \alpha_{ec} = \alpha \sim N(0,
0.0001)\)</span>.</p>
<p>In comparison, methods (3) and (4) have the commensurability
hyper-parameter <span class="math inline">\(\tau\)</span>, which acts as
the precision variable assessing the similarity between the concurrent
and external control groups. The prior of <span class="math inline">\(tau\)</span> follows a Gamma distribution
(default: shape = 1, rate = 0.001) and a half-Cauchy distribution
(default: location = 0, scale = 0.2), respectively, in methods 3 and 4.
Users can update the default values for the parameter if they wish to
customize the hyper-prior.</p>
<p>After users state the prior choices and the simulated data is ready
for use, the Markov chain Monte Carlo (MCMC) algorithm is deployed to
obtain samples from the posterior distribution.</p>
</div>
<div id="example-of-use" class="section level2">
<h2>Example of use</h2>
<p>To demonstrate how to use the package to fit the analysis model we
first generate a dataset where the time to event is drawn from the
following distribution:</p>
<p><span class="math display">\[
t_i \sim Weibull(0.95, \lambda_i)
\]</span> Where:</p>
<p><span class="math display">\[
\lambda_i =  \frac{1}{150}I_{ec} \times \frac{1}{200}I_{cc} \times
\frac{1}{400}I_{trt} \times
exp(0.2\times x_{age} - 0.1\times I_{female})
\]</span></p>
<ul>
<li><span class="math inline">\(I_{ec}\)</span> is 1 if the patient is
in the external trial else 0<br />
</li>
<li><span class="math inline">\(I_{cc}\)</span> is 1 if the patient is
in the concurrent trial else 0<br />
</li>
<li><span class="math inline">\(I_{trt}\)</span> is 1 if the patient is
in the treatment arm else 0<br />
</li>
<li><span class="math inline">\(I_{female}\)</span> is 1 if the patient
is female else 0<br />
</li>
<li><span class="math inline">\(x_{age}\)</span> is the patient’s
age</li>
</ul>
<p>Patients are then censored by drawing a censoring time from the
exponential distribution with a rate parameter of <span class="math inline">\(\lambda = 1/400\)</span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(psborrow)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(flexsurv)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">401</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>grp_lvl <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;CC&quot;</span>, <span class="st">&quot;TRT&quot;</span>, <span class="st">&quot;EC&quot;</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>sex_lvl <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>log_hr_grp <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;TRT&quot;</span> <span class="ot">=</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="dv">400</span>),</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;CC&quot;</span> <span class="ot">=</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="dv">200</span>),</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;EC&quot;</span> <span class="ot">=</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="dv">150</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>log_hr_sex <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Male&quot;</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Female&quot;</span> <span class="ot">=</span> <span class="sc">-</span><span class="fl">0.1</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>log_hr_age <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>Shape <span class="ot">&lt;-</span> <span class="fl">0.95</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">pt =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">grp =</span> <span class="fu">factor</span>(</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sample</span>(grp_lvl, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>)),</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">levels =</span> grp_lvl</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex =</span> <span class="fu">factor</span>(</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sample</span>(sex_lvl, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.6</span>)),</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">levels =</span> sex_lvl</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">lambda =</span> <span class="fu">exp</span>(</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        log_hr_age <span class="sc">*</span> age <span class="sc">+</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        log_hr_sex[<span class="fu">as.character</span>(sex)] <span class="sc">+</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        log_hr_grp[<span class="fu">as.character</span>(grp)]</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> <span class="fu">rweibullPH</span>(n, <span class="at">scale =</span> lambda, <span class="at">shape =</span> Shape),</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">centime =</span> <span class="fu">rexp</span>(n, <span class="dv">1</span> <span class="sc">/</span> <span class="dv">400</span>)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">event =</span> <span class="fu">ifelse</span>(time <span class="sc">&lt;=</span> centime, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">ifelse</span>(time <span class="sc">&lt;=</span> centime, time, centime)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(pt, grp, age, sex, time, event)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1,000 × 6</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       pt grp      age sex     time event</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;fct&gt;  &lt;dbl&gt; &lt;fct&gt;  &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1     1 TRT    1.12  Female  64.0     1</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2     2 CC    -0.577 Female  14.3     0</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3     3 CC    -0.281 Female 190.      0</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4     4 CC    -0.371 Male   348.      0</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5     5 CC     1.29  Female  43.6     1</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6     6 EC    -0.840 Male    27.8     0</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7     7 EC     0.901 Female 706.      1</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8     8 TRT    0.906 Female 105.      1</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9     9 CC     1.43  Male    57.9     1</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10    10 TRT    2.75  Female  85.9     1</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 990 more rows</span></span></code></pre></div>
<p>To conduct an analysis we need to use the <code>apply_mcmc()</code>
function. However to use this function we first need to convert our data
into the required format. Full details of the required format can be
found in <code>help(apply_mcmc)</code> however an example of this is
shown below:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>dat2 <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">trt =</span> <span class="fu">ifelse</span>(grp <span class="sc">==</span> <span class="st">&quot;TRT&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ext =</span> <span class="fu">ifelse</span>(grp <span class="sc">==</span> <span class="st">&quot;EC&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cnsr =</span> <span class="dv">1</span> <span class="sc">-</span> event) <span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(pt, trt, ext, time, cnsr, sex, age)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>dat2</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1,000 × 7</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       pt   trt   ext  time  cnsr sex       age</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;   &lt;dbl&gt;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1     1     1     0  64.0     0 Female  1.12 </span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2     2     0     0  14.3     1 Female -0.577</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3     3     0     0 190.      1 Female -0.281</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4     4     0     0 348.      1 Male   -0.371</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5     5     0     0  43.6     0 Female  1.29 </span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6     6     0     1  27.8     1 Male   -0.840</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7     7     0     1 706.      0 Female  0.901</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8     8     1     0 105.      0 Female  0.906</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9     9     0     0  57.9     0 Male    1.43 </span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10    10     1     0  85.9     0 Female  2.75 </span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 990 more rows</span></span></code></pre></div>
<p>We can now pass our data to <code>apply_mcmc()</code> to produce our
posterior samples. Prior distributions are specified using the
<code>set_prior()</code> function, details for which can be found in
<code>help(set_prior)</code> as well as the user-guide vignette.
Covariates for the analysis model need to be specified by a 1-sided
formula provided to the <code>formula_cov</code> argument. Note that the
treatment indicator is automatically added to the model and should not
be specified in the covariate formula; if you require treatment
interactions these should be specified explicitly via
<code>trt:cov</code> rather than by <code>trt*cov</code>. The intercept
term must always be included in this formula. You are advised to leave
the <code>pred</code> parameter as either “all” or “ps” depending on
your requirements. If you do wish to restrict the covariates included in
the model then this should be done by omitting them from the
<code>formula_cov</code> rather than the <code>pred</code> argument in
<code>set_prior()</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>postsamp <span class="ot">&lt;-</span> <span class="fu">apply_mcmc</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">dt =</span> dat2,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula_cov =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> age <span class="sc">+</span> sex,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">priorObj =</span> <span class="fu">set_prior</span>(<span class="at">pred =</span> <span class="st">&quot;all&quot;</span>, <span class="at">prior =</span> <span class="st">&quot;gamma&quot;</span>, <span class="at">r0 =</span> <span class="fl">0.85</span>, <span class="at">alpha =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n.chains =</span> <span class="dv">1</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n.adapt =</span> <span class="dv">100</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">n.burn =</span> <span class="dv">100</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">n.iter =</span> <span class="dv">200</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">47</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Input all is found in pred. Any other input is disregarded.</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="er">|</span>                                                  <span class="er">|</span>   <span class="dv">0</span>%</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="er">|*</span>                                                 <span class="er">|</span>   <span class="dv">2</span>%</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="er">|**</span>                                                <span class="er">|</span>   <span class="dv">4</span>%</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="er">|***</span>                                               <span class="er">|</span>   <span class="dv">6</span>%</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="er">|****</span>                                              <span class="er">|</span>   <span class="dv">8</span>%</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="er">|*****</span>                                             <span class="er">|</span>  <span class="dv">10</span>%</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="er">|******</span>                                            <span class="er">|</span>  <span class="dv">12</span>%</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="er">|*******</span>                                           <span class="er">|</span>  <span class="dv">14</span>%</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="er">|********</span>                                          <span class="er">|</span>  <span class="dv">16</span>%</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="er">|*********</span>                                         <span class="er">|</span>  <span class="dv">18</span>%</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="er">|**********</span>                                        <span class="er">|</span>  <span class="dv">20</span>%</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="er">|***********</span>                                       <span class="er">|</span>  <span class="dv">22</span>%</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  <span class="er">|************</span>                                      <span class="er">|</span>  <span class="dv">24</span>%</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  <span class="er">|*************</span>                                     <span class="er">|</span>  <span class="dv">26</span>%</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  <span class="er">|**************</span>                                    <span class="er">|</span>  <span class="dv">28</span>%</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  <span class="er">|***************</span>                                   <span class="er">|</span>  <span class="dv">30</span>%</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>  <span class="er">|****************</span>                                  <span class="er">|</span>  <span class="dv">32</span>%</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  <span class="er">|*****************</span>                                 <span class="er">|</span>  <span class="dv">34</span>%</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>  <span class="er">|******************</span>                                <span class="er">|</span>  <span class="dv">36</span>%</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>  <span class="er">|*******************</span>                               <span class="er">|</span>  <span class="dv">38</span>%</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>  <span class="er">|********************</span>                              <span class="er">|</span>  <span class="dv">40</span>%</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  <span class="er">|*********************</span>                             <span class="er">|</span>  <span class="dv">42</span>%</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>  <span class="er">|**********************</span>                            <span class="er">|</span>  <span class="dv">44</span>%</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>  <span class="er">|***********************</span>                           <span class="er">|</span>  <span class="dv">46</span>%</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>  <span class="er">|************************</span>                          <span class="er">|</span>  <span class="dv">48</span>%</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>  <span class="er">|*************************</span>                         <span class="er">|</span>  <span class="dv">50</span>%</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>  <span class="er">|**************************</span>                        <span class="er">|</span>  <span class="dv">52</span>%</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>  <span class="er">|***************************</span>                       <span class="er">|</span>  <span class="dv">54</span>%</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>  <span class="er">|****************************</span>                      <span class="er">|</span>  <span class="dv">56</span>%</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>  <span class="er">|*****************************</span>                     <span class="er">|</span>  <span class="dv">58</span>%</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>  <span class="er">|******************************</span>                    <span class="er">|</span>  <span class="dv">60</span>%</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>  <span class="er">|*******************************</span>                   <span class="er">|</span>  <span class="dv">62</span>%</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>  <span class="er">|********************************</span>                  <span class="er">|</span>  <span class="dv">64</span>%</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>  <span class="er">|*********************************</span>                 <span class="er">|</span>  <span class="dv">66</span>%</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>  <span class="er">|**********************************</span>                <span class="er">|</span>  <span class="dv">68</span>%</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>  <span class="er">|***********************************</span>               <span class="er">|</span>  <span class="dv">70</span>%</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>  <span class="er">|************************************</span>              <span class="er">|</span>  <span class="dv">72</span>%</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>  <span class="er">|*************************************</span>             <span class="er">|</span>  <span class="dv">74</span>%</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>  <span class="er">|**************************************</span>            <span class="er">|</span>  <span class="dv">76</span>%</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>  <span class="er">|***************************************</span>           <span class="er">|</span>  <span class="dv">78</span>%</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>  <span class="er">|****************************************</span>          <span class="er">|</span>  <span class="dv">80</span>%</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>  <span class="er">|*****************************************</span>         <span class="er">|</span>  <span class="dv">82</span>%</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>  <span class="er">|******************************************</span>        <span class="er">|</span>  <span class="dv">84</span>%</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>  <span class="er">|*******************************************</span>       <span class="er">|</span>  <span class="dv">86</span>%</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>  <span class="er">|********************************************</span>      <span class="er">|</span>  <span class="dv">88</span>%</span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>  <span class="er">|*********************************************</span>     <span class="er">|</span>  <span class="dv">90</span>%</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>  <span class="er">|**********************************************</span>    <span class="er">|</span>  <span class="dv">92</span>%</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>  <span class="er">|***********************************************</span>   <span class="er">|</span>  <span class="dv">94</span>%</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>  <span class="er">|************************************************</span>  <span class="er">|</span>  <span class="dv">96</span>%</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>  <span class="er">|*************************************************</span> <span class="er">|</span>  <span class="dv">98</span>%</span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                        </span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>  <span class="er">|**************************************************|</span> <span class="dv">100</span>%</span></code></pre></div>
<p>From here we can extract our posterior samples as follows:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">extract_samples</span>(postsamp))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       HR_cc_hc HR_trt_cc  alpha[1]  alpha[2]   beta_trt  beta_age beta_sexFemale        r0       tau</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,] 1.1096928 0.3671814 -4.949371 -4.845288 -1.0018994 0.2745032    -0.25909116 0.9201647  360.0789</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,] 1.0268710 0.4697018 -4.876703 -4.850186 -0.7556573 0.2539210    -0.25321051 0.9204208  283.2014</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,] 1.0575392 0.3991505 -4.942033 -4.886088 -0.9184167 0.3249545    -0.22758668 0.9211114  667.9504</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,] 1.0205880 0.4088358 -4.897589 -4.877210 -0.8944417 0.2851334    -0.16777557 0.9215409 2315.9094</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,] 0.9857758 0.3605800 -4.859848 -4.874174 -1.0200414 0.2935454    -0.18770880 0.9191615 2675.4973</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [6,] 0.9864785 0.3633342 -4.903234 -4.916847 -1.0124321 0.2535249    -0.09992967 0.9020110  783.1036</span></span></code></pre></div>
<p>For reference the returned parameters are:</p>
<ul>
<li><p><code>HR_cc_hc</code> - The hazard ratio between the historical
control arm and the concurrent control arm. This can be be thought of as
the ratio of the scale parameter between the baseline external control
distribution and the baseline trial distribution. This is equivalent to
<code>exp(alpha[2] - alpha[1])</code></p></li>
<li><p><code>HR_trt_cc</code> - The hazard ratio between the treatment
arm and the concurrent control arm. This is equivalent to
<code>exp(beta_trt)</code></p></li>
<li><p><code>alpha[1]</code> - The shape parameter for the trial’s
baseline distribution</p></li>
<li><p><code>alpha[2]</code> - The shape parameter for the historical
control’s baseline distribution</p></li>
<li><p><code>beta_trt</code> - The log-hazard ratio for the treatment
effect. This is equivalent to <code>log(HR_trt_cc)</code></p></li>
<li><p><code>beta_age</code> - The log-hazard ratio for the covariate
<code>age</code></p></li>
<li><p><code>beta_sexFemale</code> - The log-hazard ratio for the
covariate <code>sexFemale</code></p></li>
<li><p><code>r0</code> - The scale parameter for the baseline
distribution of both the trial and the historical control</p></li>
<li><p><code>tau/sigma</code> - The precision/variance for
<code>alpha[1]</code> i.e. controls how much information is borrowed
from the historical control arm</p></li>
</ul>
<p>If <code>prior = &quot;no_ext&quot;</code> or <code>prior = &quot;full_ext&quot;</code>
then <code>alpha[1]</code> and <code>alpha[2]</code> will be replaced
with a single parameter <code>alpha</code> representing the shape
parameter for the single baseline distribution for the trail.</p>
<p>Additionally general summary statistics of our samples can be
generated by the <code>summary()</code> function:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(postsamp)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        parameter         mean           sd        lci           uci</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1       HR_cc_hc    1.0112903   0.03767595  0.9401316    1.09642467</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2      HR_trt_cc    0.3857669   0.03881582  0.3230326    0.46980137</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3       alpha[1]   -4.9414910   0.09106815 -5.0775808   -4.76802672</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4       alpha[2]   -4.9309512   0.08729994 -5.0899134   -4.75289074</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5       beta_trt   -0.9573926   0.09823656 -1.1300021   -0.75544616</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6       beta_age    0.2781143   0.04180654  0.2019639    0.35759578</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7 beta_sexFemale   -0.1390660   0.07769175 -0.2664242    0.02923811</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8             r0    0.9239697   0.01768511  0.8921297    0.95277956</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 9            tau 1002.0669283 999.10913348 49.5932394 3564.40952449</span></span></code></pre></div>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<ol style="list-style-type: decimal">
<li><p>Lu, Y., Lin, A., Pang, H., Zhu, J. (2021). PSBORROW: BAYESIAN
DYNAMIC BORROWING R TOOL FOR COMPLEX INNOVATIVE TRIAL DESIGNS. ASA
Biopharmaceutical Report, 28 (3), 11-19.</p></li>
<li><p>Lewis, C. J., Sarkar, S., Zhu, J., &amp; Carlin, B. P. (2019).
Borrowing from historical control data in cancer drug development: a
cautionary tale and practical guidelines. Statistics in
biopharmaceutical research, 11(1), 67-78.</p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
